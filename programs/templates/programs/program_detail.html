{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ program.name }} - {{ program.university.name }} - TrikonED{% endblock %}

{% block content %}
<main class="flex-1 w-full bg-background">
    <div class="px-4 sm:px-6 lg:px-8 py-8">
        <div class="max-w-7xl mx-auto">
            <!-- Breadcrumbs -->
            <div class="flex flex-wrap gap-2 pb-6">
                <a class="text-text-secondary text-sm font-medium leading-normal hover:text-primary transition-colors"
                    href="{% url 'core:landing' %}">Home</a>
                <span class="text-text-secondary text-sm font-medium leading-normal">/</span>
                <a class="text-text-secondary text-sm font-medium leading-normal hover:text-primary transition-colors"
                    href="{% url 'universities:list' %}">Universities</a>
                <span class="text-text-secondary text-sm font-medium leading-normal">/</span>
                <a class="text-text-secondary text-sm font-medium leading-normal hover:text-primary transition-colors"
                    href="{% url 'universities:detail' program.university.slug %}">{{ program.university.name }}</a>
                <span class="text-text-secondary text-sm font-medium leading-normal">/</span>
                <span class="text-text-primary text-sm font-medium leading-normal">
                    {{ program.name }}</span>
            </div>

            <!-- Header Card -->
            <div class="bg-white rounded-xl border border-border p-6 mb-6">
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex flex-col sm:flex-row gap-6 flex-1">
                        {% if program.university.image and program.university.image.url %}
                        <img src="{{ program.university.image.url }}" alt="{{ program.university.name }}"
                            class="bg-center bg-no-repeat aspect-square bg-cover rounded-xl w-full sm:w-32 h-32 flex-shrink-0">
                        {% else %}
                        <img src="https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=1200"
                            alt="{{ program.university.name }}"
                            class="bg-center bg-no-repeat aspect-square bg-cover rounded-xl w-full sm:w-32 h-32 flex-shrink-0" />
                        {% endif %}
                        <div class="flex flex-col justify-center">
                            <h1
                                class="text-text-primary text-3xl md:text-4xl font-bold leading-tight tracking-tight mb-2">
                                {{ program.name }}</h1>
                            <p class="text-text-secondary text-lg font-medium leading-normal mb-1">
                                {{ program.university.name }}</p>
                            <p class="text-text-secondary text-lg font-medium">
                                {{ program.university.get_location_display }}
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center md:items-end">
                        {% if user.is_authenticated %}
                        <a href="{% url 'applications:wizard' %}?program={{ program.slug }}&university={{ program.university.slug }}"
                            class="w-full sm:w-auto flex min-w-[120px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] hover:opacity-90 transition-all">
                            <span class="truncate">Apply Now</span>
                        </a>
                        {% else %}
                        <a href="{% url 'students:login' %}?next={{ request.path }}"
                            class="w-full sm:w-auto flex min-w-[120px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] hover:opacity-90 transition-all">
                            <span class="truncate">Login to Apply</span>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="flex flex-col gap-2 rounded-xl p-6 border border-border bg-white">
                    <p class="text-text-secondary text-sm font-medium leading-normal">Tuition Fees
                        {% if program.tuition_fees.first %}
                        <span class="text-xs">({{ program.tuition_fees.first.get_per_display }})</span>
                        {% endif %}
                    </p>
                    <p class="text-text-primary text-lg font-bold leading-tight">
                        {% if program.tuition_fees.first %}
                        {{ program.tuition_fees.first.currency }} {{ program.tuition_fees.first.amount|floatformat:0 }}
                        {% if program.tuition_fees.first.max_amount %}
                        - {{ program.tuition_fees.first.currency }} {{ program.tuition_fees.first.max_amount|floatformat:0 }}
                        {% endif %}
                        {% else %}
                        Contact University
                        {% endif %}
                    </p>
                </div>
                <div class="flex flex-col gap-2 rounded-xl p-6 border border-border bg-white">
                    <p class="text-text-secondary text-sm font-medium leading-normal">Program Duration
                    </p>
                    <p class="text-text-primary text-lg font-bold leading-tight">
                        {{ program.type.duration }} {{ program.type.get_duration_unit_display }}</p>
                </div>
                <div class="flex flex-col gap-2 rounded-xl p-6 border border-border bg-white">
                    <p class="text-text-secondary text-sm font-medium leading-normal">Next Intake</p>
                    <p class="text-text-primary text-lg font-bold leading-tight">
                        {% if program.intakes.first %}
                        {{ program.intakes.first.start_date|date:"F Y" }}
                        {% else %}
                        See Details
                        {% endif %}
                    </p>
                </div>
                <div class="flex flex-col gap-2 rounded-xl p-6 border border-border bg-white">
                    <p class="text-text-secondary text-sm font-medium leading-normal">IELTS Score</p>
                    <p class="text-text-primary text-lg font-bold leading-tight">
                        {% if program.english_requirements.first and program.english_requirements.first.ielts %}
                        {{ program.english_requirements.first.ielts }}+
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Tabs Section -->
            <div class="bg-white rounded-xl border border-border overflow-hidden">
                <!-- Tab Headers -->
                <div class="border-b border-border">
                    <div class="flex gap-8 overflow-x-auto px-6">
                        <a class="flex flex-col items-center justify-center border-b-[3px] border-b-primary text-primary pb-[13px] pt-4 cursor-pointer tab-link whitespace-nowrap"
                            data-tab="overview">
                            <p class="text-sm font-bold leading-normal tracking-[0.015em]">Overview</p>
                        </a>
                        <a class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-text-secondary hover:text-primary transition-colors pb-[13px] pt-4 cursor-pointer tab-link whitespace-nowrap"
                            data-tab="admission">
                            <p class="text-sm font-bold leading-normal tracking-[0.015em]">Admission Requirements</p>
                        </a>
                        <a class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-text-secondary hover:text-primary transition-colors pb-[13px] pt-4 cursor-pointer tab-link whitespace-nowrap"
                            data-tab="curriculum">
                            <p class="text-sm font-bold leading-normal tracking-[0.015em]">Curriculum</p>
                        </a>
                        <a class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-text-secondary hover:text-primary transition-colors pb-[13px] pt-4 cursor-pointer tab-link whitespace-nowrap"
                            data-tab="university">
                            <p class="text-sm font-bold leading-normal tracking-[0.015em]">University Info</p>
                        </a>
                    </div>
                </div>

                <!-- Tab Contents -->
                <div class="p-6">
                    <div class="text-base text-text-primary leading-relaxed space-y-4 tab-content" id="overview">
                        <h3 class="text-xl font-bold text-text-primary mb-4">Program Overview</h3>
                        <div class="prose max-w-none text-text-secondary">
                            {{ program.description|linebreaks }}
                        </div>
                    </div>

                    <div class="text-base text-text-primary leading-relaxed space-y-4 tab-content hidden"
                        id="admission">
                        <h3 class="text-xl font-bold text-text-primary mb-4">Admission Requirements</h3>
                        <div class="prose max-w-none text-text-secondary">
                            {{ program.type.entry_requirements|linebreaks }}
                        </div>

                        <!-- English Requirements -->
                        {% if program.english_requirements.first %}
                        <div class="mt-6 pt-6 border-t border-border">
                            <h4 class="text-lg font-bold text-text-primary mb-4">English Language
                                Requirements</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-10 gap-4">
                                {% if program.english_requirements.first.ielts %}
                                <div class="bg-background rounded-lg p-4 border border-border">
                                    <p class="text-xs font-bold uppercase tracking-wider text-text-secondary mb-1">
                                        IELTS</p>
                                    <p class="text-2xl font-bold text-primary">{{ program.english_requirements.first.ielts }}+</p>
                                </div>
                                {% endif %}

                                {% if program.english_requirements.first.toefl %}
                                <div class="bg-background rounded-lg p-4 border border-border">
                                    <p class="text-xs font-bold uppercase tracking-wider text-text-secondary mb-1">
                                        TOEFL</p>
                                    <p class="text-2xl font-bold text-primary">{{ program.english_requirements.first.toefl }}+</p>
                                </div>
                                {% endif %}

                                {% if program.english_requirements.first.pte %}
                                <div class="bg-background rounded-lg p-4 border border-border">
                                    <p class="text-xs font-bold uppercase tracking-wider text-text-secondary mb-1">
                                        PTE</p>
                                    <p class="text-2xl font-bold text-primary">{{ program.english_requirements.first.pte }}+</p>
                                </div>
                                {% endif %}
                            </div>

                            {% if program.english_requirements.first.extra_requirements %}
                            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <p class="text-sm font-semibold text-blue-700 mb-2">Additional
                                    Requirements:</p>
                                <ul class="list-disc list-inside text-sm text-blue-600 space-y-1">
                                    {% for key, value in program.english_requirements.first.extra_requirements.items %}
                                    <li>{{ key }}: {{ value }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="text-base text-text-primary leading-relaxed space-y-4 tab-content hidden"
                        id="curriculum">
                        <h3 class="text-xl font-bold text-text-primary mb-4">Curriculum</h3>
                        <p class="text-text-secondary">Detailed curriculum information is available upon
                            request. Please contact the university for the full syllabus.</p>
                    </div>

                    <div class="text-base text-text-primary leading-relaxed space-y-4 tab-content hidden"
                        id="university">
                        <h3 class="text-xl font-bold text-text-primary mb-4">About {{ program.university.name }}</h3>
                        <div class="prose max-w-none text-text-secondary">
                            {{ program.university.description|linebreaks }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.tab-link');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                // Remove active class from all tabs
                tabs.forEach(t => {
                    t.classList.remove('border-b-primary', 'text-primary');
                    t.classList.add('border-b-transparent', 'text-text-secondary');
                });

                // Add active class to clicked tab
                tab.classList.remove('border-b-transparent', 'text-text-secondary');
                tab.classList.add('border-b-primary', 'text-primary');

                // Hide all contents
                contents.forEach(c => c.classList.add('hidden'));

                // Show target content
                const targetId = tab.dataset.tab;
                document.getElementById(targetId).classList.remove('hidden');
            });
        });
    });
</script>
{% endblock %}